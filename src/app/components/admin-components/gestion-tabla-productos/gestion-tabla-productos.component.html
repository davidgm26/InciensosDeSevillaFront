<p-toast></p-toast>
<div class="w-full max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
  <div class="flex justify-between items-center">
    <div class="card flex flex-col sm:flex-row items-center justify-between m-5">
      <p-select [options]="listaCategorias" [(ngModel)]="selectedCategoria" optionLabel="nombre"
        placeholder="Selecciona una categoria" class="w-full md:w-56" (ngModelChange)="cambioCategoria($event)" />
    </div>
    <input type="text" pInputText (input)="buscador($event)" name="" id="" class="p-2 border border-gray-300 rounded-md"
      placeholder="Buscar producto" />
  </div>
  <p-table 
  [value]="listaProductos"
  [paginator]="true" 
  [rows]="rows" 
  [totalRecords]="totalRecords"
  [rowsPerPageOptions]="rowsPerPageOptions" 
  [lazy]="true" (onPage)="onPageChange($event)" paginatorPosition="bottom"
  class="w-full">
    <ng-template pTemplate="header">
      <tr class="bg-gray-100">
        <th class="p-2 sm:p-3 text-left hidden sm:table-cell">Precio</th>
        <th class="p-2 sm:p-3 text-left">Nombre</th>
        <th class="p-2 sm:p-3 text-left hidden md:table-cell">Descripcion</th>
        <th class="p-2 sm:p-3 text-left hidden lg:table-cell">Categoria</th>
        <th class="p-2 sm:p-3 text-center">Acciones</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-producto>
      <tr class="border-b hover:bg-gray-50 transition-colors">
        <td class="p-2 sm:p-3 hidden sm:table-cell">{{producto.precio}} â‚¬</td>
        <td class="p-2 sm:p-3">{{producto.nombre}}</td>
        <td class="p-2 sm:p-3 hidden md:table-cell">{{producto.descripcion}}</td>
        <td class="p-2 sm:p-3 hidden lg:table-cell">{{producto.categoria}}</td>
        <td class="p-2 sm:p-3">
          <div class="flex justify-center space-x-2">
            <button
              class="bg-red-600 hover:bg-red-700 w-8 h-8 sm:w-10 sm:h-10 rounded flex items-center justify-center transition-colors"
              (click)="confirmBorrarProducto(producto.id)">
              <i class="pi pi-trash text-white text-sm sm:text-base"></i>
            </button>
            <button
              class="bg-pink-600 hover:bg-pink-700 w-8 h-8 sm:w-10 sm:h-10 rounded flex items-center justify-center transition-colors"
              (click)="editarProducto(producto)">
              <i class="pi pi-pencil text-white text-sm sm:text-base"></i>
            </button>
            <button
              (click)="cambiarVisibilidad(producto.id)"
              class="bg-green-600 hover:bg-green-700 w-8 h-8 sm:w-10 sm:h-10 rounded flex items-center justify-center transition-colors">
              <i class="pi pi-eye text-white text-sm sm:text-base"></i>
            </button>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
  <p-confirmdialog></p-confirmdialog>
  <p-dialog header="Editar Producto" [(visible)]="visible" [style]="{ width: '60vw' }" (onHide)="onHide()"
    [modal]="true">
    <div class="p-fluid"></div>
    <span class="p-text-secondary block mb-8">Editar Producto</span>
    <form [formGroup]="editForm" (ngSubmit)="onSubmit()">
      <div class="p-field">
        <p-select 
        formControlName="categoria" 
        [options]="listaCategorias" 
        optionLabel="nombre" 
        placeholder=""
        class="w-full md:w-56">
      </p-select>
      </div>
      <div class="p-field"></div>
      <label for="nombre" class="block text-sm font-medium text-gray-700">Nombre</label>
      <input id="nombre" type="text" pInputText formControlName="nombre"
        class="mt-1 block w-full p-2 border border-gray-300 rounded-md" />
      <div *ngIf="formControls['nombre'].invalid && (formControls['nombre'].dirty || formControls['nombre'].touched)"
        class="text-red-600 text-sm">
        <div *ngIf="formControls['nombre'].errors?.['required']">El nombre es requerido.</div>
        <div *ngIf="formControls['nombre'].errors?.['pattern']">El nombre solo puede contener letras</div>
      </div>
      <div class="p-field"></div>
      <label for="precio" class="block text-sm font-medium text-gray-700">Precio</label>
      <input id="precio" type="number" pInputText formControlName="precio"
        class="mt-1 block w-full p-2 border border-gray-300 rounded-md" />
      <div *ngIf="formControls['precio'].invalid && (formControls['precio'].dirty || formControls['precio'].touched)"
        class="text-red-600 text-sm">
        <div *ngIf="formControls['precio'].errors?.['required']">El precio es requerido.</div>
      </div>
      <div class="p-field"></div>
      <label for="descripcion" class="block text-sm font-medium text-gray-700">Descripcion</label>
      <textarea rows="5" cols="30" pTextarea formControlName="descripcion"class="mt-1 block w-full p-2 border border-gray-300 rounded-md"></textarea>
      <div
        *ngIf="formControls['descripcion'].invalid && (formControls['descripcion'].dirty || formControls['descripcion'].touched)"
        class="text-red-600 text-sm">
        <div *ngIf="formControls['descripcion'].errors?.['required']">La descripcion es requerida.</div>
      </div>
      <div class="flex justify-end gap-2 m-5">
        <p-button label="Cancel" severity="secondary" (click)="onHide()" />
        <p-button label="Save" type="submit" />
      </div>
    </form>
  </p-dialog>
</div>